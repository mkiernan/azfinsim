# AzFinSim: Fintech Risk Simulation

**AzFinSim** is a simple Python application for synthetic risk simulation. This is forked
from https://github.com/mkiernan/azfinsim to remove all Azure infrastructure code and
simply be structured as standard Python application for risk analysis.

## Getting Started

This is a Python based application and hence requires Python 3.8 or newer to be installed
on the workstation. The application can be installed using PIP. A virtual environment is recommended
to avoid clobbering your Python environment. Alternatively, you can use the Docker-based
approach, described [here](#docker).

```sh
# clone repository
git clone https://github.com/utkarshayachit/azfinsim.git

cd azfinsim

# create virtual environment
python3 -m venv env0

# activate virtual environment
source env0/bin/activate

# upgrade pip
python3 -m pip install --upgrade pip

# install azfinsim (-e is optional)
python3 -m pip install -e .

# validate installation
python3 -m azfinsim.azfinsim --help
# this should generate output as follows:
usage: azfinsim [-h] [--config CONFIG] [--verbose VERBOSE] ...
...

# to exit virtual environment use the following
deactivate
```

> **Note**
> Don't forget to activate the virtual environment before trying out any
> of the tools using commands described in the following sections.

## Design and Usage

The `azfinsim` package includes following tools as executable Python modules:

1. `azfinsim.generator`: a tool to generate synthetic trade data; the generated data can be stored in
   redis cache or on disk.
1. `azfinsim.splitter`: a tool to split generated synthetic data generated by the `generator`.  It can read
   the data from redis cache or disk and generate partitioned datasets on disk.
1. `azfinsim.concat`: a simple tool to concatenate multiple files in to one.
1. `azfinsim.azfinsim`: a tool process trades from disk or redis cache and optionally generate synthetic data results.

### Generating synthetic trades

The `azfinsim.generator` can be used to generate synthetic dataset. In a real world setup, this step shouldn't be necessary since
the data will be coming from some real data source.

To generate trades, use the following command. You can populate a redis cache or save the trades
to a file on the filesystem. Additional cache types can easily be added by modifying [`cache.py`](../src/azfinsim/cache.py).

```sh
# populate redis cache
python3 -m azfinsim.generator                             \
        --cache-type   "redis"                            \
        --cache-name   <redis url>                        \
        --cache-key    <redis key>                        \
        --start-trade  <start trade number>               \
        --trade-window <total number of trades to generate>

# populate file on disk
python3 -m azfinsim.generator                             \
        --cache-type   "filesystem"                       \
        --cache-path   <filename>                         \
        --start-trade  <start trade number>               \
        --trade-window <total number of trades to generate>
```

When using redis cache, the generator will populate the cache using multiple threads concurrently. For filesystem,
currently we only support sequential data generation.

### Processing trades

This step emulates the data processing stage in a financial data processing workflow.

```sh
# process trades
python3 -m azfinsim.azfinsim --cache-name <redis url>       \
        --cache-key <redis key>                             \
        --start-trade <start trade number>                  \
        --trade-window <total number of trades to process>
```

Optionally, arguments can be read in from a json config file which can be specified
using the `--config` command line option.

## Docker

Instead of installing the application locally, you can build and use a
container instead. For that, you'll need Docker installed on your workstation.

```sh
# clone repository
git clone https://github.com/utkarshayachit/azfinsim.git -b refactor

cd azfinsim
# to build the container image
docker build -t azfinsim:latest .

# test the container
docker run -it azfinsim:latest -m azfinsim.azfinsim --help

# now, you can run the application using the following instead of
# `python3` (as described earlier)

# generate trades
docker run -it azfinsim:latest -m azfinsim.generator        \
        --cache-name <redis url>                            \
        --cache-key <redis key>                             \
        --start-trade <start trade number>                  \
        --trade-window <total number of trades to generate>

# process trades
docker run -it azfinsim:latest -m azfinsim.azfinsim         \
        --cache-name <redis url>                            \
        --cache-key <redis key>                             \
        --start-trade <start trade number>                  \
        --trade-window <total number of trades to process>
```
